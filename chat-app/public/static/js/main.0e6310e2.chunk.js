(this["webpackJsonpreact-client"]=this["webpackJsonpreact-client"]||[]).push([[0],{62:function(e,t,r){},97:function(e,t,r){"use strict";r.r(t);var n=r(5),c=r(0),s=r.n(c),a=r(13),i=r.n(a),o=(r(60),r(36)),l=r(35),u=r.n(l),d=r(51),j=r(18),b=(r(62),r(52)),h=r(100),f=r(101),m=r(104),O=r(102),p=r(105),x=r(103),v=r(54),g=r(106);function y(e,t,r,n){null===e?n("error, no connection to server"):e.emit(t,r)}function w(e){var t=e.messages,r=e.id,s=e.users,a=Object(c.useRef)(null),i=Object(c.useRef)(null);t.sort((function(e,t){return Date.parse(e.time_stamp)-Date.parse(t.time_stamp)}));var o=Object.fromEntries(s.map((function(e){return[e.id.toString(),e]}))),l=t.length-1,u=t.map((function(e,t){var c=o[e.from.toString()],s={};c.id===r&&(s={fontWeight:"bold"});var i=new Date(e.time_stamp),u=Object(n.jsxs)(n.Fragment,{children:[Object(n.jsx)("td",{style:{width:"15%"},children:i.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit",hour12:!1})}),Object(n.jsx)("td",{style:{color:c.color,width:"15%"},children:c.username}),Object(n.jsx)("td",{style:{width:"70%"},children:e.content})]});return t===l?Object(n.jsx)("tr",{ref:a,style:s,children:u},"messagesUl"+t):Object(n.jsx)("tr",{style:s,children:u},"messagesUl"+t)}));return Object(c.useLayoutEffect)((function(){null!==a.current&&JSON.stringify(t)!==JSON.stringify(i.current)&&a.current.scrollIntoView(),i.current=t}),[t]),Object(n.jsx)("div",{className:"table-bottom-div",children:Object(n.jsx)(h.a,{responsive:!0,striped:!0,bordered:!0,hover:!0,children:Object(n.jsx)("tbody",{children:u})})})}function S(e){var t=e.users,r=e.id,c=t.find((function(e){return e.id===r})),s=t.filter((function(e){return 0!==e.number_of_connections&&e.id!==r}));if(s.sort(),"undefined"===typeof c)return Object(n.jsx)("div",{children:"error, could not find user"});var a=s.map((function(e){return Object(n.jsx)("tr",{children:Object(n.jsx)("td",{style:{color:e.color},children:e.username})},e.username+" user name row")}));return Object(n.jsxs)(h.a,{responsive:!0,striped:!0,bordered:!0,hover:!0,children:[Object(n.jsx)("thead",{children:Object(n.jsx)("tr",{children:Object(n.jsx)("th",{children:"Users"})})}),Object(n.jsxs)("tbody",{children:[Object(n.jsx)("tr",{children:Object(n.jsx)("td",{style:{color:c.color},children:c.username+" (you)"})}),a]})]})}var k=function(){var e=Object(c.useState)(null),t=Object(j.a)(e,2),r=t[0],s=t[1],a=function(e){var t=Object(c.useState)({users:[],messages:[]}),r=Object(j.a)(t,2),n=r[0],s=r[1],a=Object(c.useRef)(null),i=Object(c.useState)(null),l=Object(j.a)(i,2),h=l[0],f=l[1];Object(c.useEffect)((function(){!function(){var t=Object(d.a)(u.a.mark((function t(){var r,n,c;return u.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("/userId");case 3:if(!(r=t.sent).ok){t.next=17;break}return t.t0=parseInt,t.next=8,r.text();case 8:t.t1=t.sent,n=(0,t.t0)(t.t1),f(n),(c=Object(b.io)().connect()).on("chat_state",(function(e){return s(JSON.parse(e))})),c.on("input_error",(function(t){e(t)})),a.current=c,t.next=22;break;case 17:return t.t2=e,t.next=20,r.text();case 20:t.t3=t.sent,(0,t.t2)(t.t3);case 22:t.next=27;break;case 24:t.prev=24,t.t4=t.catch(0),e(t.t4.message);case 27:case"end":return t.stop()}}),t,null,[[0,24]])})));return function(){return t.apply(this,arguments)}}()()}),[e]);var m=Object(c.useCallback)((function(t){return y(a.current,"chat message",t,e)}),[a,e]),O=Object(c.useCallback)((function(t){return y(a.current,"rename",t,e)}),[a,e]),p=Object(c.useCallback)((function(t){return y(a.current,"recolor","#"+t,e)}),[a,e]);return Object(o.a)(Object(o.a)({},n),{},{id:h,sendMessage:m,updateName:O,updateColor:p})}(s),i=a.users,l=a.messages,h=a.id,k=a.sendMessage,N=a.updateName,C=a.updateColor,E=Object(c.useState)(""),_=Object(j.a)(E,2),B=_[0],J=_[1],R=function(e){e.preventDefault();var t=B.trim();try{if(t.startsWith("/name"))N(function(e){var t=e.match(/^[/]name ([A-Za-z0-9]+)$/);if(null===t)throw new Error("invalid rename, please only use letters or numbers for name");return t[1]}(t)),J("");else if(t.startsWith("/color"))C(function(e){var t=e.match(/^[/]color ([a-fA-F0-9]{6})$/);if(null===t)throw new Error("invalid color, please only use format '/color RRGGBB'");return t[1].toUpperCase()}(t)),J("");else if(t.startsWith("/"))s("error, illegal command '".concat(t,"'. /name and /color are the only available commands. lowercase is needed."));else if(""!==t){var r=function(e){return e.replace(/[:][)]/,"\ud83d\ude01").replace(/[:][(]/,"\ud83d\ude41").replace(/[:][o]/,"\ud83d\ude32")}(t);k(r),J("")}}catch(n){s(n.message)}};return null===h||0===i.length?Object(n.jsx)("div",{className:"loading",children:Object(n.jsx)(f.a,{animation:"border"})}):Object(n.jsxs)("div",{className:"App",children:[Object(n.jsxs)(m.a,{show:null!==r,onHide:function(){return s(null)},children:[Object(n.jsx)(m.a.Header,{closeButton:!0,children:Object(n.jsx)(m.a.Title,{children:"Error"})}),Object(n.jsx)(m.a.Body,{children:r})]}),Object(n.jsx)(w,{messages:l,id:h,users:i}),Object(n.jsx)(S,{id:h,users:i}),Object(n.jsx)("div",{className:"centering",children:Object(n.jsx)(O.a,{children:Object(n.jsx)(p.a,{onSubmit:R,children:Object(n.jsxs)(x.a,{children:[Object(n.jsx)(v.a,{onChange:function(e){J(e.target.value)},placeholder:"message","aria-label":"message",value:B,onSubmit:R}),Object(n.jsx)(x.a.Append,{children:Object(n.jsx)(g.a,{variant:"outline-secondary",type:"submit",children:"Send"})})]})})})})]})};i.a.render(Object(n.jsx)(s.a.StrictMode,{children:Object(n.jsx)(k,{})}),document.getElementById("root"))}},[[97,1,2]]]);
//# sourceMappingURL=main.0e6310e2.chunk.js.map